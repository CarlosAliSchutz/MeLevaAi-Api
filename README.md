# API Me Leva Aí

API para gestão de corridas.

- [API Me Leva Aí](#api-me-leva-aí)
  - [Estrutura Geral Objeto Passageiro](#estrutura-geral-objeto-passageiro)
  - [Estrutura Geral Objeto Motorista](#estrutura-geral-objeto-motorista)
  - [Funcionalidades da API](#funcionalidades-da-api)
    - [Passageiros](#passageiros)
    - [Motoristas](#motoristas)
  - [Dados](#dados)
    - [Schema](#schema)
    - [Inserts](#inserts)
    - [Queries](#queries)
  - [Modelo de dados](#modelo-de-dados)
    - [Motorista:](#motorista)
    - [Veículo:](#veículo)
    - [Passageiro:](#passageiro)
  - [Tecnologias usadas](#tecnologias-usadas)

## Estrutura Geral Objeto Passageiro

- id: `Long id`
- Nome: `String nome`
- Data Nascimento: `LocalDate dataNascimento` (apenas maiores de 16 anos)
- CPF: `String cpf` (só pode ser único)
- Score: `float score` (média das notas que o passageiro recebe em cada corrida)
- Saldo: `BigDecimal saldo` (dinheiro disponível)
- Corridas: `List corridas` (lista das corridas que o passageiro já andou)

## Estrutura Geral Objeto Motorista

- id: `Long id`
- Nome: `String nome`
- Data Nascimento: `LocalDate dataNascimento` (apenas maiores de 18 anos)
- CPF: `String cpf` (só pode ser único)
- Score: `float score` (média das notas que o motorista recebe em cada corrida)
- Saldo: `BigDecimal saldo` (dinheiro disponível)
- Corridas: `List corridas` (lista das corridas que o motorista já realizou)
- CNH: `licencaMotorista` (contém `numero`, categoria `A, B, C` e `dataVencimento`)
- Veículo: `veiculo` (contem `placa`, `modelo`, `cor`, `foto` e `categoria`)

## Funcionalidades da API

### Passageiros

- Listar passageiros disponíveis: `GET /passageiros`
- Incluir passageiro: `POST /passageiros`
- Solicitar nova corrida: `POST /passageiros/{id}/solicitarCorrida`
- Depositar dinheiro ao passageiro: `PUT /passageiros/{id}/depositarCredito`
- Avaliar motorista: `PUT /passageiros/avaliarMotorista`

### Motoristas

- Listar Motoristas: `GET /motoristas`
- Incluir motorista autorizados: `POST /motoristas`
- Adicionar habilitacao: `POST /motoristas/habilitacao`
- Adicionar veiculo: `POST /veiculos`
- Listar corridas: `GET /corridas`
- Iniciar corrida: `PUT /corridas/{id}`
- Finalizar corrida: `PUT /corridas/{id}/finalizar`
- Avaliar passageiro: `PUT /motoristas/avaliarPassageiro`
- Sacar dinheiro da conta virtual: `PUT /motoristas/{id}/conta-virtual`

## Dados

### Schema

```sql
DROP TABLE IF EXISTS motorista CASCADE;
DROP TABLE IF EXISTS passageiro CASCADE;
DROP TABLE IF EXISTS licenca_motorista CASCADE;
DROP TABLE IF EXISTS veiculo CASCADE;
DROP TABLE IF EXISTS corrida CASCADE;


CREATE TABLE motorista (
    id 				BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  	nome 			VARCHAR(100) NOT NULL,
  	data_nascimento DATE NOT NULL,
	cpf				VARCHAR(11)	 NOT NULL,
	score			DOUBLE PRECISION,
	saldo			DECIMAL
);

ALTER TABLE motorista ADD CONSTRAINT pk_motorista PRIMARY KEY (id);
ALTER TABLE motorista ADD CONSTRAINT uk_motorista_cpf UNIQUE (cpf);


CREATE TABLE licenca_motorista (
	id 				BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	numero			VARCHAR(11) NOT NULL,
	categoria 		VARCHAR(1) NOT NULL,
	data_vencimento	Date NOT NULL,
	motorista_id	BIGINT NOT NULL
);

ALTER TABLE licenca_motorista ADD CONSTRAINT pk_licenca_motorista PRIMARY KEY (id);
ALTER TABLE licenca_motorista ADD CONSTRAINT categoria_check CHECK (categoria IN ('A', 'B', 'C'));
ALTER TABLE licenca_motorista ADD CONSTRAINT fk_licenca_motorista_motorista FOREIGN KEY (motorista_id) REFERENCES  motorista;


CREATE TABLE passageiro (
    id 				BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  	nome 			VARCHAR(100) NOT NULL,
  	data_nascimento DATE NOT NULL,
	cpf				VARCHAR(11)	 NOT NULL,
	score 			DOUBLE PRECISION,
	saldo			DECIMAL
);

ALTER TABLE passageiro ADD CONSTRAINT pk_passageiro PRIMARY KEY (id);
ALTER TABLE passageiro ADD CONSTRAINT uk_passageiro_cpf UNIQUE (cpf);


CREATE TABLE veiculo (
    id 				BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  	placa 			VARCHAR(10)  NOT NULL,
  	modelo		 	VARCHAR(50)  NOT NULL,
	cor				VARCHAR(20)	 NOT NULL,
	foto			VARCHAR(255) NOT NULL,
	categoria 		VARCHAR(1)   NOT NULL,
	motorista_id	BIGINT       NOT NULL
);

ALTER TABLE veiculo ADD CONSTRAINT pk_veiculo PRIMARY KEY (id);
ALTER TABLE veiculo ADD CONSTRAINT categoria_check CHECK (categoria IN ('A', 'B', 'C'));
ALTER TABLE veiculo ADD CONSTRAINT fk_veiculo_motorista FOREIGN KEY (motorista_id) REFERENCES  motorista;


CREATE TABLE corrida (
	id 				BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	iniciox			DOUBLE PRECISION NOT NULL,
	inicioy			DOUBLE PRECISION NOT NULL,
	fimx			DOUBLE PRECISION NOT NULL,
	fimy			DOUBLE PRECISION NOT NULL,
	hora_inicio		TIMESTAMP,
	hora_chegada	TIMESTAMP,
	status			VARCHAR(20) NOT NULL,
	motorista_id	BIGINT NOT NULL,
	passageiro_id	BIGINT NOT NULL,
	score_motorista INT,
	score_passageiro INT
);

ALTER TABLE corrida ADD CONSTRAINT pk_corrida PRIMARY KEY (id);
ALTER TABLE corrida ADD CONSTRAINT status_check CHECK (status IN ('SOLICITADA', 'INICIADA', 'FINALIZADA'));
ALTER TABLE corrida ADD CONSTRAINT fk_corrida_motorista FOREIGN KEY (motorista_id) REFERENCES  motorista;
ALTER TABLE corrida ADD CONSTRAINT fk_corrida_passageiro FOREIGN KEY (passageiro_id) REFERENCES passageiro;
```

### Inserts

```sql
INSERT INTO passageiro (nome, data_nascimento, cpf, score, saldo) VALUES
('Diêison', '1992-05-31', '33743131595', 5, 1000),
('Maria', '1965-07-20', '34380561356', 4.7, 2000),
('Lucas', '2000-11-26', '28584385444', 4.2, 1150),
('Carla', '1988-04-05', '17348184766', 4.8, 2500);

INSERT INTO motorista (nome, data_nascimento, cpf, score, saldo) VALUES
('Matheus', '1998-03-11', '83127138164', 5, 1000),
('Ana', '2002-03-12', '51247621871', 4.8, 640),
('Jose', '1979-10-06', '25168037887', 4.6, 1150),
('Carlos', '1995-11-29', '17348184766', 4.87, 2300);

INSERT INTO licenca_motorista (numero, categoria, data_vencimento, motorista_id) VALUES
('52096194630', 'A', '2025-10-22', 1),
('53386058458', 'B', '2023-12-29', 2),
('63202760052', 'C', '2024-06-24', 3),
('45202894826', 'B', '2025-09-30', 4);

INSERT INTO veiculo (placa, modelo, cor, foto, categoria, motorista_id) VALUES
('MUV-7548', 'CG 160 Titan', 'vermelho', 'https://cabralmotor.fbitsstatic.net/img/p/cg-160-titan-70286/257004-3.jpg?w=1000&h=1000&v=no-change&qs=ignore', 'A', 1),
('MNL-3684', 'Audi a3', 'preto', 'https://i.imgur.com/HlNs3Sq.png', 'B', 2),
('IAB-3767', 'kombi', 'branco', 'https://i.imgur.com/5aSA7JB.png', 'C', 3),
('MPQ-6958', 'fiesta', 'azul', 'https://s2.glbimg.com/HEMrUrYpAPg5vNpe4_h_28yGvB4=/0x0:620x413/984x0/smart/filters:strip_icc()/i.s3.glbimg.com/v1/AUTH_cf9d035bf26b4646b105bd958f32089d/internal_photos/bs/2020/w/2/TYxKZnR0m6EJ5iXsPXnA/2017-11-24-ford-fiesta-titanium-01.jpg', 'B', 4);
```

### Queries

```sql
SELECT 	m.id,
        m.nome,
		m.data_nascimento,
		m.cpf,
		m.score,
		m.saldo,
		v.modelo,
		v.cor,
		l.categoria,
		l.data_vencimento AS LicencaVencimento
FROM motorista m
	LEFT JOIN veiculo v ON v.motorista_id = m.id
	LEFT JOIN licenca_motorista l ON l.motorista_id = m.id;
```

## Modelo de dados

### Motorista:

- Nome completo
- Data de Nascimento
- CPF
- Carteira de Habilitação
  - Número
  - Categoria
  - Data Vencimento
- Regras:
  - O motorista deve possuir mais de 18 anos
  - O CPF deve ser válido
  - Não deve ser possível cadastrar 2 motoristas iguais, ou seja, com o mesmo CPF
  - Só pode ter um veículo

### Veículo:

- Placa
- Modelo
- Cor
- Foto (url da foto)
- Categoria
- Proprietário (Motorista)
- Regras:
  - O proprietário deve possuir um documento com categoria que permita dirigir este veículo
  - As categorias possíveis são: `A`, `B`, `C`;

### Passageiro:

- Nome completo
- Data de Nascimento
- CPF
- Regras:
  - O passageiro deve possuir mais de 16 anos
  - O CPF deve ser válido
  - Não deve ser possível cadastrar 2 passageiros iguais, ou seja, com o mesmo CPF

## Tecnologias usadas

[![Skills](https://skillicons.dev/icons?i=spring,react,html,css,js,&perline=5)](https://skillicons.dev)
